{% extends "base.html" %}

{% block title %}–ü–æ—à—É–∫ –≤–∏–∫–ª–∞–¥–∞—á—ñ–≤ - Mentorion{% endblock %}

{% block content %}
<div style="margin-top: 2rem;">
    <h1 class="text-center">üîç –ü–æ—à—É–∫ –≤–∏–∫–ª–∞–¥–∞—á—ñ–≤</h1>
    <p class="text-center text-muted mb-4">–ó–Ω–∞–π–¥—ñ—Ç—å –≤–∏–∫–ª–∞–¥–∞—á–∞ –¥–ª—è –∫—É—Ä—Å–æ–≤–æ—ó —Ä–æ–±–æ—Ç–∏</p>

    <!-- Filters Card -->
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="card-title">üîé –§—ñ–ª—å—Ç—Ä–∏ –ø–æ—à—É–∫—É</h3>
        </div>
        <div class="card-body">
            <form method="GET">
                <div class="d-flex gap-2" style="flex-wrap: wrap;">
                    <div class="form-group" style="flex: 1; min-width: 200px;">
                        <label for="department">–ö–∞—Ñ–µ–¥—Ä–∞</label>
                        <select name="department" id="department">
                            <option value="">–í—Å—ñ –∫–∞—Ñ–µ–¥—Ä–∏</option>
                            {% for dept in departments %}
                            <option value="{{ dept.id }}"{% if selected_department == dept.id|stringformat:"s" %} selected{% endif %}>
                                {{ dept.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group" style="flex: 1; min-width: 200px;">
                        <label for="interest">–ù–∞—É–∫–æ–≤—ñ —ñ–Ω—Ç–µ—Ä–µ—Å–∏</label>
                        <select name="interest" id="interest">
                            <option value="">–í—Å—ñ —ñ–Ω—Ç–µ—Ä–µ—Å–∏</option>
                            {% for int in interests %}
                            <option value="{{ int.id }}"{% if selected_interest == int.id|stringformat:"s" %} selected{% endif %}>
                                {{ int.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group" style="display: flex; align-items: flex-end; gap: 0.5rem;">
                        <button type="submit" class="btn btn-primary">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
                        <a href="{% url 'searching:filter_teachers' %}" class="btn btn-outline">–°–∫–∏–Ω—É—Ç–∏</a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Results -->
    {% if teachers %}
    <h2 class="mb-3">–ó–Ω–∞–π–¥–µ–Ω–æ –≤–∏–∫–ª–∞–¥–∞—á—ñ–≤: {{ teachers.count }}</h2>
    <div class="card-grid">
        {% for teacher in teachers %}
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">{{ teacher.user.first_name }} {{ teacher.user.last_name }}</h3>
                {% if teacher.available_slots_count > 0 %}
                <span class="badge badge-success">–î–æ—Å—Ç—É–ø–Ω–∏–π</span>
                {% else %}
                <span class="badge badge-warning">–ù–µ–º–∞—î –º—ñ—Å—Ü—å</span>
                {% endif %}
            </div>
            <div class="card-body">
                {% if teacher.department %}
                <p><strong>–ö–∞—Ñ–µ–¥—Ä–∞:</strong> {{ teacher.department.name }}</p>
                {% endif %}

                {% if teacher.scientific_interests.all %}
                <p><strong>–Ü–Ω—Ç–µ—Ä–µ—Å–∏:</strong></p>
                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem;">
                    {% for interest in teacher.scientific_interests.all %}
                    <span class="badge badge-primary">{{ interest.name }}</span>
                    {% endfor %}
                </div>
                {% endif %}

                {% if teacher.bio %}
                <p class="text-muted" style="font-size: 0.9rem;">
                    {{ teacher.bio|truncatewords:15 }}
                </p>
                {% endif %}

                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--color-border);">
                    <p class="mb-0">
                        <strong>–î–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å:</strong>
                        <span
                            style="color: {% if teacher.available_slots_count > 0 %}var(--color-success){% else %}var(--color-error){% endif %};">
                            {{ teacher.available_slots_count }} / {{ teacher.total_slots_count }} –≤—ñ–ª—å–Ω–∏—Ö
                        </span>
                    </p>
                </div>
            </div>
            <div class="card-footer">
                <a href="{% url 'searching:teacher_detail' teacher.id %}" class="btn btn-secondary btn-sm"
                    style="width: 100%;">
                    üëÅÔ∏è –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å
                </a>
            </div>
        </div>
        {% endfor %}
    </div>

    {% else %}
    <div class="card">
        <div class="card-body text-center" style="padding: 3rem;">
            <h3 style="color: var(--color-text-secondary); margin-bottom: 1rem;">üîç –í–∏–∫–ª–∞–¥–∞—á—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h3>
            <p class="text-muted mb-3">
                –°–ø—Ä–æ–±—É–π—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –∞–±–æ —Å–∫–∏–Ω—å—Ç–µ —Ñ—ñ–ª—å—Ç—Ä–∏
            </p>
            <a href="{% url 'searching:filter_teachers' %}" class="btn btn-primary">–°–∫–∏–Ω—É—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏</a>
        </div>
    </div>
    {% endif %}

    <!-- Back to Profile -->
    <div style="margin-top: 2rem;">
        <a href="{% url 'profiles:student_profile' %}" class="btn btn-outline">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –ø—Ä–æ—Ñ—ñ–ª—é</a>
    </div>
</div>
{% endblock %}