{% extends "base.html" %}

{% block title %}Деталі слота #{{ slot.id }}{% endblock %}

{% block content %}
<div style="margin-top: 2rem;">
  <h1>Деталі слота #{{ slot.id }}</h1>

  <!-- Slot Information -->
  <div class="card">
    <div class="card-header">
      <h2 class="card-title"> Інформація про слот</h2>
      {% if slot.is_filled %}
      <span class="badge badge-danger">Зайнятий</span>
      {% else %}
      <span class="badge badge-success">Вільний</span>
      {% endif %}
    </div>
    <div class="card-body">
      <p><strong>Статус:</strong>
        {% if slot.is_filled %}
        <span style="color: var(--color-error);">●</span> Зайнятий
        {% else %}
        <span style="color: var(--color-success);">●</span> Вільний
        {% endif %}
      </p>
      {% if slot.topic %}
      <p><strong>Тема курсової:</strong> {{ slot.topic }}</p>
      {% else %}
      <p class="text-muted"><strong>Тема курсової:</strong> <em>Не встановлена</em></p>
      {% endif %}
      <p><strong>Створено:</strong> {{ slot.created_at|date:"d.m.Y H:i" }}</p>
    </div>
    {% if not slot.is_filled %}
    <div class="card-footer">
      <a href="{% url 'searching:edit_slot' slot.id %}" class="btn btn-primary btn-sm">Редагувати тему</a>
    </div>
    {% endif %}
  </div>

  <!-- Assigned Student (if exists) -->
  {% if slot.student %}
  <div class="card">
    <div class="card-header">
      <h2 class="card-title"> Прикріплений студент</h2>
    </div>
    <div class="card-body">
      <table style="width: 100%; border: none; box-shadow: none;">
        <tbody>
          <tr style="background: none;">
            <td style="border: none; font-weight: 600; width: 30%;">ПІБ:</td>
            <td style="border: none;">{{ slot.student.user.first_name }} {{ slot.student.user.last_name }}</td>
          </tr>
          <tr style="background: none;">
            <td style="border: none; font-weight: 600;">Email:</td>
            <td style="border: none;"><a href="mailto:{{ slot.student.user.email }}">{{ slot.student.user.email }}</a>
            </td>
          </tr>
          <tr style="background: none;">
            <td style="border: none; font-weight: 600;">Група:</td>
            <td style="border: none;">{{ slot.student.group }}</td>
          </tr>
          <tr style="background: none;">
            <td style="border: none; font-weight: 600;">Курс:</td>
            <td style="border: none;">{{ slot.student.get_year_of_study_display }}</td>
          </tr>
          {% if slot.student.course_topic %}
          <tr style="background: none;">
            <td style="border: none; font-weight: 600;">Тема курсової:</td>
            <td style="border: none;">{{ slot.student.course_topic }}</td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}

  <!-- Request History -->
  <div class="card">
    <div class="card-header">
      <h2 class="card-title"> Історія запитів</h2>
    </div>
    <div class="card-body">
      {% if requests %}
      <div style="display: flex; flex-direction: column; gap: 1rem;">
        {% for req in requests %}
        <div class="card" style="margin: 0;">
          <div class="card-header" style="padding: 1rem;">
            <div class="d-flex justify-between align-center">
              <strong>{{ req.student.user.first_name }} {{ req.student.user.last_name }}</strong>
              {% if req.status == 'pending' %}
              <span class="badge badge-warning">{{ req.get_status_display }}</span>
              {% elif req.status == 'approved' %}
              <span class="badge badge-success">{{ req.get_status_display }}</span>
              {% elif req.status == 'rejected' %}
              <span class="badge badge-danger">{{ req.get_status_display }}</span>
              {% endif %}
            </div>
          </div>
          <div class="card-body" style="padding: 1rem;">
            <p class="text-muted mb-2">
              <small>{{ req.created_at|date:"d.m.Y H:i" }}</small>
            </p>
            {% if req.message %}
            <p
              style="margin-top: 0.5rem; padding: 0.75rem; background: var(--color-background); border-radius: var(--radius-md);">
              <strong>Повідомлення:</strong><br>
              {{ req.message }}
            </p>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p class="text-muted text-center" style="padding: 2rem;">Запитів ще немає</p>
      {% endif %}
    </div>
  </div>

  <!-- Back Button -->
  <div style="margin-top: 2rem;">
    <a href="{% url 'searching:teacher_slots' %}" class="btn btn-outline">← Назад до слотів</a>
  </div>
</div>
{% endblock %}