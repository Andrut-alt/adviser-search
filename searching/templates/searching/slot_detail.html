{% extends "base.html" %}

{% block title %}–î–µ—Ç–∞–ª—ñ —Å–ª–æ—Ç–∞ #{{ slot.id }}{% endblock %}

{% block content %}
<div style="margin-top: 2rem;">
  <h1>üìÖ –î–µ—Ç–∞–ª—ñ —Å–ª–æ—Ç–∞ #{{ slot.id }}</h1>

  <!-- Slot Information -->
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">üìä –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–ª–æ—Ç</h2>
      {% if slot.is_filled %}
      <span class="badge badge-danger">–ó–∞–π–Ω—è—Ç–∏–π</span>
      {% else %}
      <span class="badge badge-success">–í—ñ–ª—å–Ω–∏–π</span>
      {% endif %}
    </div>
    <div class="card-body">
      <p><strong>–°—Ç–∞—Ç—É—Å:</strong>
        {% if slot.is_filled %}
        <span style="color: var(--color-error);">‚óè</span> –ó–∞–π–Ω—è—Ç–∏–π
        {% else %}
        <span style="color: var(--color-success);">‚óè</span> –í—ñ–ª—å–Ω–∏–π
        {% endif %}
      </p>
      <p><strong>–°—Ç–≤–æ—Ä–µ–Ω–æ:</strong> {{ slot.created_at|date:"d.m.Y H:i" }}</p>
    </div>
  </div>

  <!-- Assigned Student (if exists) -->
  {% if slot.student %}
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">üë®‚Äçüéì –ü—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω–∏–π —Å—Ç—É–¥–µ–Ω—Ç</h2>
    </div>
    <div class="card-body">
      <table style="width: 100%; border: none; box-shadow: none;">
        <tbody>
          <tr style="background: none;">
            <td style="border: none; font-weight: 600; width: 30%;">–ü–Ü–ë:</td>
            <td style="border: none;">{{ slot.student.user.first_name }} {{ slot.student.user.last_name }}</td>
          </tr>
          <tr style="background: none;">
            <td style="border: none; font-weight: 600;">Email:</td>
            <td style="border: none;"><a href="mailto:{{ slot.student.user.email }}">{{ slot.student.user.email }}</a>
            </td>
          </tr>
          <tr style="background: none;">
            <td style="border: none; font-weight: 600;">–ì—Ä—É–ø–∞:</td>
            <td style="border: none;">{{ slot.student.group }}</td>
          </tr>
          <tr style="background: none;">
            <td style="border: none; font-weight: 600;">–ö—É—Ä—Å:</td>
            <td style="border: none;">{{ slot.student.get_year_of_study_display }}</td>
          </tr>
          {% if slot.student.course_topic %}
          <tr style="background: none;">
            <td style="border: none; font-weight: 600;">–¢–µ–º–∞ –∫—É—Ä—Å–æ–≤–æ—ó:</td>
            <td style="border: none;">{{ slot.student.course_topic }}</td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}

  <!-- Request History -->
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">üìú –Ü—Å—Ç–æ—Ä—ñ—è –∑–∞–ø–∏—Ç—ñ–≤</h2>
    </div>
    <div class="card-body">
      {% if requests %}
      <div style="display: flex; flex-direction: column; gap: 1rem;">
        {% for req in requests %}
        <div class="card" style="margin: 0;">
          <div class="card-header" style="padding: 1rem;">
            <div class="d-flex justify-between align-center">
              <strong>{{ req.student.user.first_name }} {{ req.student.user.last_name }}</strong>
              {% if req.status == 'pending' %}
              <span class="badge badge-warning">{{ req.get_status_display }}</span>
              {% elif req.status == 'approved' %}
              <span class="badge badge-success">{{ req.get_status_display }}</span>
              {% elif req.status == 'rejected' %}
              <span class="badge badge-danger">{{ req.get_status_display }}</span>
              {% endif %}
            </div>
          </div>
          <div class="card-body" style="padding: 1rem;">
            <p class="text-muted mb-2">
              <small>üìÖ {{ req.created_at|date:"d.m.Y H:i" }}</small>
            </p>
            {% if req.message %}
            <p
              style="margin-top: 0.5rem; padding: 0.75rem; background: var(--color-background); border-radius: var(--radius-md);">
              <strong>–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:</strong><br>
              {{ req.message }}
            </p>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p class="text-muted text-center" style="padding: 2rem;">–ó–∞–ø–∏—Ç—ñ–≤ —â–µ –Ω–µ–º–∞—î</p>
      {% endif %}
    </div>
  </div>

  <!-- Back Button -->
  <div style="margin-top: 2rem;">
    <a href="{% url 'searching:teacher_slots' %}" class="btn btn-outline">‚Üê –ù–∞–∑–∞–¥ –¥–æ —Å–ª–æ—Ç—ñ–≤</a>
  </div>
</div>
{% endblock %}