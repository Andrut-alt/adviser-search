{% extends "base.html" %}

{% block title %}{{ teacher.user.first_name }} {{ teacher.user.last_name }} - –ü—Ä–æ—Ñ—ñ–ª—å –≤–∏–∫–ª–∞–¥–∞—á–∞{% endblock %}

{% block content %}
<div style="margin-top: 2rem;">
  <h1> {{ teacher.user.first_name }} {{ teacher.user.last_name }}</h1>

  <!-- Teacher Information Card -->
  <div class="card">
    <div class="card-header">
      <h2 class="card-title"> –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤–∏–∫–ª–∞–¥–∞—á–∞</h2>
    </div>
    <div class="card-body">
      <table style="width: 100%; border: none; box-shadow: none;">
        <tbody>
          <tr style="background: none;">
            <td style="border: none; font-weight: 600; width: 30%;">Email:</td>
            <td style="border: none;"><a href="mailto:{{ teacher.user.email }}">{{ teacher.user.email }}</a></td>
          </tr>
          {% if teacher.department %}
          <tr style="background: none;">
            <td style="border: none; font-weight: 600;">–ö–∞—Ñ–µ–¥—Ä–∞:</td>
            <td style="border: none;">{{ teacher.department.name }}</td>
          </tr>
          {% endif %}
          {% if teacher.bio %}
          <tr style="background: none;">
            <td style="border: none; font-weight: 600;">–ü—Ä–æ —Å–µ–±–µ:</td>
            <td style="border: none;">{{ teacher.bio }}</td>
          </tr>
          {% endif %}
          {% if teacher.scientific_interests.all %}
          <tr style="background: none;">
            <td style="border: none; font-weight: 600;">–ù–∞—É–∫–æ–≤—ñ —ñ–Ω—Ç–µ—Ä–µ—Å–∏:</td>
            <td style="border: none;">
              {% for interest in teacher.scientific_interests.all %}
              <span class="badge badge-primary">{{ interest.name }}</span>
              {% endfor %}
            </td>
          </tr>
          {% endif %}
          <tr style="background: none;">
            <td style="border: none; font-weight: 600;">–î–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å:</td>
            <td style="border: none;">
              <strong>{{ teacher.available_slots_count }}</strong> –∑ <strong>{{ teacher.total_slots_count }}</strong>
              —Å–ª–æ—Ç—ñ–≤ –≤—ñ–ª—å–Ω–æ
              {% if teacher.available_slots_count > 0 %}
              <span class="badge badge-success">–î–æ—Å—Ç—É–ø–Ω–∏–π</span>
              {% else %}
              <span class="badge badge-warning">–ù–µ–º–∞—î –≤—ñ–ª—å–Ω–∏—Ö –º—ñ—Å—Ü—å</span>
              {% endif %}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Available Slots (topics hidden from students) -->
  {% if first_available_slot %}
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">üìã –î–æ—Å—Ç—É–ø–Ω—ñ —Å–ª–æ—Ç–∏</h2>
    </div>
    <div class="card-body">
      {% if available_slots %}
      <div style="display: flex; flex-direction: column; gap: 1rem;">
        {% for slot in available_slots %}
        <div class="card" style="margin: 0; border-left: 3px solid var(--color-success);">
          <div class="card-body">
            <div class="d-flex justify-between align-center" style="margin-bottom: 0.5rem;">
              <strong>–°–ª–æ—Ç #{{ slot.id }}</strong>
              <span class="badge badge-success">–í—ñ–ª—å–Ω–∏–π</span>
            </div>
            {% if slot.topic %}
            <p><strong>–¢–µ–º–∞ –∫—É—Ä—Å–æ–≤–æ—ó:</strong> {{ slot.topic }}</p>
            {% else %}
            <p class="text-muted" style="margin: 0.5rem 0;"><em>–¢–µ–º—É –∫—É—Ä—Å–æ–≤–æ—ó —â–µ –Ω–µ –≤–∫–∞–∑–∞–Ω–æ. –£–∑–≥–æ–¥–∂—É–π—Ç–µ —Ç–µ–º—É –ø—Ä–∏ –∑—É—Å—Ç—Ä—ñ—á—ñ.</em></p>
            {% endif %}
            <p class="text-muted mb-0" style="font-size: 0.85rem; margin-top: 0.5rem;">
              <small>–°—Ç–≤–æ—Ä–µ–Ω–æ: {{ slot.created_at|date:"d.m.Y H:i" }}</small>
            </p>
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %}
    </div>
  </div>
  {% endif %}

  <!-- Request Status or Form -->
  {% if active_request %}
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">‚è≥ –°—Ç–∞—Ç—É—Å –∑–∞–ø–∏—Ç—É</h2>
      {% if active_request.status == 'pending' %}
      <span class="badge badge-warning">{{ active_request.get_status_display }}</span>
      {% elif active_request.status == 'approved' %}
      <span class="badge badge-success">{{ active_request.get_status_display }}</span>
      {% elif active_request.status == 'rejected' %}
      <span class="badge badge-danger">{{ active_request.get_status_display }}</span>
      {% endif %}
    </div>
    <div class="card-body">
      <p>
        {% if active_request.status == 'pending' %}
        –í–∞—à –∑–∞–ø–∏—Ç –æ—á—ñ–∫—É—î –Ω–∞ —Ä–æ–∑–≥–ª—è–¥ –≤–∏–∫–ª–∞–¥–∞—á–µ–º
        {% elif active_request.status == 'approved' %}
        –í—ñ—Ç–∞—î–º–æ! –í–∏–∫–ª–∞–¥–∞—á –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏–≤ –≤–∞—à –∑–∞–ø–∏—Ç
        {% elif active_request.status == 'rejected' %}
        –ù–∞ –∂–∞–ª—å, –≤–∞—à –∑–∞–ø–∏—Ç –±—É–ª–æ –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ
        {% endif %}
      </p>
    </div>
  </div>

  {% elif has_assigned_slot %}
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">–í–∏ –≤–∂–µ –ø—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω—ñ</h2>
    </div>
    <div class="card-body">
      <p>–í–∏ –≤–∂–µ –ø—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω—ñ –¥–æ —Ü—å–æ–≥–æ –≤–∏–∫–ª–∞–¥–∞—á–∞. –î–ª—è –∑–º—ñ–Ω–∏ –≤–∏–∫–ª–∞–¥–∞—á–∞ –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—ó.</p>
    </div>
  </div>

  {% elif can_send_request and available_slots %}
  <div class="card">
    <div class="card-header">
      <h2 class="card-title"> –í–∏–±—Ä–∞—Ç–∏ —Å–ª–æ—Ç —Ç–∞ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–∞–ø–∏—Ç</h2>
    </div>
    <div class="card-body">
      <form method="post" action="{% url 'searching:send_request' 0 %}" id="slot-request-form">
        {% csrf_token %}
        <div class="form-group">
          <label for="slot_id">–í–∏–±—Ä–∞—Ç–∏ —Å–ª–æ—Ç *</label>
          <select name="slot_id" id="slot_id" required>
            <option value="">-- –û–±–µ—Ä—ñ—Ç—å —Å–ª–æ—Ç --</option>
            {% for slot in available_slots %}
            <option value="{{ slot.id }}">–°–ª–æ—Ç #{{ slot.id }}{% if slot.topic %} ‚Äî {{ slot.topic }}{% endif %}</option>
            {% endfor %}
          </select>
          <small class="text-muted">–Ø–∫—â–æ —Ç–µ–º–∞ –≤–∫–∞–∑–∞–Ω–∞ ‚Äî –≤–æ–Ω–∞ –ø–æ–∫–∞–∑–∞–Ω–∞ –ø–æ—Ä—É—á –∑—ñ —Å–ª–æ—Ç–æ–º.</small>
        </div>

        <div class="form-group">
          <label for="message">–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–∏–∫–ª–∞–¥–∞—á—É (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)</label>
          <textarea name="message" id="message" rows="4"
            placeholder="–†–æ–∑–∫–∞–∂—ñ—Ç—å –∫–æ—Ä–æ—Ç–∫–æ –ø—Ä–æ –≤–∞—à—É –º–æ—Ç–∏–≤–∞—Ü—ñ—é —Ç–∞ —á–æ–º—É –æ–±—Ä–∞–ª–∏ —Ü—å–æ–≥–æ –≤–∏–∫–ª–∞–¥–∞—á–∞..."></textarea>
          <span class="form-help">–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ–ø–æ–º–æ–∂–µ –≤–∏–∫–ª–∞–¥–∞—á—É –∫—Ä–∞—â–µ –∑—Ä–æ–∑—É–º—ñ—Ç–∏ –≤–∞—à—É –º–æ—Ç–∏–≤–∞—Ü—ñ—é</span>
        </div>
        <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
           –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–∞–ø–∏—Ç –Ω–∞ —Å–ª–æ—Ç
        </button>
      </form>
    </div>
  </div>

  {% else %}
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">–ù–µ–º–∞—î –≤—ñ–ª—å–Ω–∏—Ö —Å–ª–æ—Ç—ñ–≤</h2>
    </div>
    <div class="card-body text-center" style="padding: 2rem;">
      <p class="text-muted">–ù–∞ –∂–∞–ª—å, —É —Ü—å–æ–≥–æ –≤–∏–∫–ª–∞–¥–∞—á–∞ –∑–∞—Ä–∞–∑ –Ω–µ–º–∞—î –≤—ñ–ª—å–Ω–∏—Ö –º—ñ—Å—Ü—å –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ–π.</p>
      <a href="{% url 'searching:filter_teachers' %}" class="btn btn-secondary mt-3">
        –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —ñ–Ω—à–∏—Ö –≤–∏–∫–ª–∞–¥–∞—á—ñ–≤
      </a>
    </div>
  </div>
  {% endif %}

  <!-- Back Button -->
  <div style="margin-top: 2rem;">
    <a href="{% url 'searching:filter_teachers' %}" class="btn btn-outline">‚Üê –ù–∞–∑–∞–¥ –¥–æ –ø–æ—à—É–∫—É</a>
  </div>
</div>
{% endblock %}