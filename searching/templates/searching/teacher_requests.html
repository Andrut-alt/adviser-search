{% extends "base.html" %}

{% block title %}Запити від студентів - Mentorion{% endblock %}

{% block content %}
<div style="margin-top: 2rem;">
  <h1> Запити від студентів</h1>
  <p class="text-muted mb-4">Перегляд та обробка запитів на консультації</p>

  {% if requests %}
  <div class="table-responsive">
    <table>
      <thead>
        <tr>
          <th>Студент</th>
          <th>Курс</th>
          <th>Тема курсової</th>
          <th>Статус</th>
          <th>Дата створення</th>
          <th>Дії</th>
        </tr>
      </thead>
      <tbody>
        {% for req in requests %}
        <tr>
          <td>
            <strong>{{ req.student.user.first_name }} {{ req.student.user.last_name }}</strong><br>
            <small class="text-muted">{{ req.student.user.email }}</small>
          </td>
          <td>{{ req.student.get_year_of_study_display }}</td>
          <td>{{ req.student.course_topic|default:"Не вказано" }}</td>
          <td>
            {% if req.status == 'pending' %}
            <span class="badge badge-warning">{{ req.get_status_display }}</span>
            {% elif req.status == 'approved' %}
            <span class="badge badge-success">{{ req.get_status_display }}</span>
            {% elif req.status == 'rejected' %}
            <span class="badge badge-danger">{{ req.get_status_display }}</span>
            {% endif %}
          </td>
          <td>{{ req.created_at|date:"d.m.Y H:i" }}</td>
          <td>
            {% if req.status == 'pending' %}
            {% if not req.slot.is_filled %}
            <a href="{% url 'searching:approve_request' req.id %}" class="btn btn-success btn-sm">✅ Підтвердити</a>
            <a href="{% url 'searching:reject_request' req.id %}" class="btn btn-danger btn-sm">❌ Відхилити</a>
            {% else %}
            <span class="badge">Слот зайнятий</span>
            {% endif %}
            {% else %}
            <span class="text-muted">—</span>
            {% endif %}
          </td>
        </tr>
        {% if req.message %}
        <tr style="background: var(--color-background);">
          <td colspan="6" style="padding: 1rem;">
            <strong>Повідомлення:</strong> {{ req.message }}
          </td>
        </tr>
        {% endif %}
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% else %}
  <div class="card">
    <div class="card-body text-center" style="padding: 3rem;">
      <h3 style="color: var(--color-text-secondary); margin-bottom: 1rem;">Запитів немає</h3>
      <p class="text-muted">Коли студенти надішлють запити на консультації, вони з'являться тут</p>
    </div>
  </div>
  {% endif %}

  <!-- Back Button -->
  <div style="margin-top: 2rem;">
    <a href="{% url 'profiles:teacher_profile' %}" class="btn btn-outline">← Назад до профілю</a>
  </div>
</div>
{% endblock %}