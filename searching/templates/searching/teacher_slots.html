{% extends "base.html" %}

{% block title %}–ú–æ—ó —Å–ª–æ—Ç–∏ - Mentorion{% endblock %}

{% block content %}
<div style="margin-top: 2rem;">
  <div class="d-flex justify-between align-center mb-3">
    <h1>üìÖ –ú–æ—ó —Å–ª–æ—Ç–∏</h1>
    {% if can_create_slot %}
    <a href="{% url 'searching:create_slot' %}" class="btn btn-primary">‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π —Å–ª–æ—Ç</a>
    {% endif %}
  </div>

  <!-- Statistics -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="d-flex gap-3" style="justify-content: space-around; text-align: center;">
        <div>
          <div style="font-size: 2rem; font-weight: bold; color: var(--color-primary);">{{ slots.count }}</div>
          <div class="text-muted">–ü–æ—Ç–æ—á–Ω–∏—Ö —Å–ª–æ—Ç—ñ–≤</div>
        </div>
        <div>
          <div style="font-size: 2rem; font-weight: bold; color: var(--color-secondary);">{{ max_slots }}</div>
          <div class="text-muted">–ú–∞–∫—Å–∏–º—É–º —Å–ª–æ—Ç—ñ–≤</div>
        </div>
        <div>
          <div style="font-size: 2rem; font-weight: bold; color: var(--color-success);">
            {{ remaining_slots }}</div>
          <div class="text-muted">–ú–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏</div>
        </div>
      </div>
    </div>
  </div>

  {% if not can_create_slot %}
  <div class="card mb-4">
    <div class="card-body">
      <p class="text-center text-muted mb-0">
        ‚ö†Ô∏è –î–æ—Å—è–≥–Ω—É—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ª–æ—Ç—ñ–≤
      </p>
    </div>
  </div>
  {% endif %}

  <!-- Slots List -->
  <h2 class="mb-3">–°–ø–∏—Å–æ–∫ —Å–ª–æ—Ç—ñ–≤</h2>

  {% if slots %}
  <div style="display: flex; flex-direction: column; gap: 1rem;">
    {% for slot in slots %}
    <div class="card"
      style="border-left: 4px solid {% if slot.is_filled %}var(--color-error){% else %}var(--color-success){% endif %};">
      <div class="card-header">
        <div class="d-flex justify-between align-center">
          <h3 class="card-title" style="margin: 0;">–°–ª–æ—Ç #{{ slot.id }}</h3>
          {% if slot.is_filled %}
          <span class="badge badge-danger">–ó–∞–π–Ω—è—Ç–∏–π</span>
          {% else %}
          <span class="badge badge-success">–í—ñ–ª—å–Ω–∏–π</span>
          {% endif %}
        </div>
      </div>
      <div class="card-body">
        {% if slot.student %}
        <table style="width: 100%; border: none; box-shadow: none;">
          <tbody>
            <tr style="background: none;">
              <td style="border: none; font-weight: 600; width: 25%;">–°—Ç—É–¥–µ–Ω—Ç:</td>
              <td style="border: none;">{{ slot.student.user.first_name }} {{ slot.student.user.last_name }}</td>
            </tr>
            <tr style="background: none;">
              <td style="border: none; font-weight: 600;">Email:</td>
              <td style="border: none;"><a href="mailto:{{ slot.student.user.email }}">{{ slot.student.user.email }}</a>
              </td>
            </tr>
            <tr style="background: none;">
              <td style="border: none; font-weight: 600;">–ö—É—Ä—Å:</td>
              <td style="border: none;">{{ slot.student.get_year_of_study_display }}</td>
            </tr>
            {% if slot.student.course_topic %}
            <tr style="background: none;">
              <td style="border: none; font-weight: 600;">–¢–µ–º–∞ –∫—É—Ä—Å–æ–≤–æ—ó:</td>
              <td style="border: none;">{{ slot.student.course_topic }}</td>
            </tr>
            {% endif %}
          </tbody>
        </table>
        {% else %}
        <p class="text-muted">–°–ª–æ—Ç –≤—ñ–ª—å–Ω–∏–π –¥–ª—è –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏</p>
        {% endif %}
        <p class="text-muted mb-0" style="margin-top: 1rem;">
          <small>üìÖ –°—Ç–≤–æ—Ä–µ–Ω–æ: {{ slot.created_at|date:"d.m.Y H:i" }}</small>
        </p>
      </div>
      <div class="card-footer">
        <a href="{% url 'searching:slot_detail' slot.id %}" class="btn btn-secondary btn-sm">üëÅÔ∏è –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –¥–µ—Ç–∞–ª—ñ</a>
        {% if not slot.is_filled %}
        <a href="{% url 'searching:delete_slot' slot.id %}" class="btn btn-danger btn-sm"
          onclick="return confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Å–ª–æ—Ç?');">
          üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏
        </a>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>

  {% else %}
  <div class="card">
    <div class="card-body text-center" style="padding: 3rem;">
      <h3 style="color: var(--color-text-secondary); margin-bottom: 1rem;">üì≠ –°–ª–æ—Ç—ñ–≤ –Ω–µ–º–∞—î</h3>
      <p class="text-muted mb-3">–°—Ç–≤–æ—Ä—ñ—Ç—å –ø–µ—Ä—à–∏–π —Å–ª–æ—Ç –¥–ª—è –ø—Ä–∏–π–æ–º—É —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó</p>
      {% if can_create_slot %}
      <a href="{% url 'searching:create_slot' %}" class="btn btn-primary">‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–µ—Ä—à–∏–π —Å–ª–æ—Ç</a>
      {% endif %}
    </div>
  </div>
  {% endif %}

  <!-- Back Button -->
  <div style="margin-top: 2rem;">
    <a href="{% url 'profiles:teacher_profile' %}" class="btn btn-outline">‚Üê –ù–∞–∑–∞–¥ –¥–æ –ø—Ä–æ—Ñ—ñ–ª—é</a>
  </div>
</div>
{% endblock %}